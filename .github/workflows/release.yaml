name: Release
on:
  push:
    branches:
      - main
      - test
  pull_request:
    branches:
      - main
      - test

permissions:
  contents: read

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup python
        uses: actions/setup-python@v1

      - name: Install tools
        run: |
          sudo apt-get install moreutils
          pip install crudini

      - name: Set SDLAPP_VERSION_CURRENT
        run: echo "SDLAPP_VERSION_CURRENT=$(jq -r '.meta.version' globalConfig.json)" >> $GITHUB_ENV

      - name: Test current
        run: echo "${{ env.SDLAPP_VERSION_CURRENT }}"

      - name: Set SDLAPP_VERSION_NEW
        run: echo "SDLAPP_VERSION_NEW=`awk -vFS=. -vOFS=. '{$NF++;print}' <<<'${{ env.SDLAPP_VERSION_CURRENT }}'`" >> $GITHUB_ENV

      - name: Test new
        run: echo "${{ env.SDLAPP_VERSION_NEW }}"

      - name: list
        run: |
          ls -l
          ls -l scripts

      - name: Increase version
        run: sh ./scripts/increaseVersion.sh

#      - name: Commit version changes
#          uses: test-room-7/action-update-file@v1.8.0
#          with:
#            file-path: |
#              globalConfig.json
#              TA_dataset/app.manifest
#              TA_dataset/default/app.conf
#            commit-msg: Release
#            github-token: ${{ secrets.GITHUB_TOKEN }}
